# Krr Course Singularity

Singularity Image for the KRR course

## Building the image

Steps:

1. create a sub directory called 'pkgs' (in the same directory as the `Singularity` file)

   ```bash
      mkdir pkgs
   ```

1. use `vcstool` (or `wstool`) to clone/download the dependencies (as specified in `retail_store_lightweight_sim.repos`).

   ```bash
      vcs import < retail_store_lightweight_sim.repos pkgs
   ```

   Adding packages to `pkg` will allow `rosdep` to install all required build and run dependencies into the image, so students can then proceed to build those packages in their own workspaces (otherwise builds would fail due to missing dependencies).

   **Note**  Packages in `pkg` will be installed on the image, their source will **not** be included in the image itself, so there may be some elements that are not installed. So far I've only noticed one required change.

1. Modify the `CMakeList.txt` file from the `pal_navigation_sm` inside the `pkgs` folder.

   Change the `install` instruction (starts at line 10) by adding some scripts as follows.

   ```bash
   install(
   PROGRAMS
      scripts/map_setup.py
      scripts/pal_navigation_main_sm.py
      scripts/navigation.sh
      scripts/base_maps_symlink.sh
      scripts/cp_maps_to_home.sh
      scripts/cp_pose_to_home.sh
      DESTINATION ${CATKIN_PACKAGE_BIN_DESTINATION})
   ```

1. check the `VERSION` variable inside the `docker_build.sh`, `build.sh` and `Singularity` files.

1. run `docker_build.sh`

   ```bash
      ./docker_build.sh
   ```

   After some time and a successful build, a new docker image will be created. This requires Docker to be installed and configured.

1. run `build.sh`

   ```bash
      ./build.sh
   ```

After some time and a successful build, a new `.simg` should be generated by `singularity` in the `cwd`.

## Using the image

After building the image, it can be `shell`ed into using the regular Singularity `shell` action:

```bash
singularity shell /path/to/ro47014-NN-XX.simg
```

where `NN-XX` is the version of the image.

Sourcing `/opt/ros/melodic/setup.bash` will also activate all the tiago dependencies installed on the image.

Once inside the image, follow the usage instructions at [https://gitlab.tudelft.nl/mgarzonoviedo/krr_course_singularity/-/blob/master/Usage_instructions.md](https://gitlab.tudelft.nl/mgarzonoviedo/krr_course_singularity/-/blob/master/Usage_instructions.md) to install create the ws and install the repo.
